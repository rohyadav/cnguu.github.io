(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{657:function(a,_,v){"use strict";v.r(_);var r=v(15),t=Object(r.a)({},(function(){var a=this,_=a.$createElement,v=a._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[v("h2",{attrs:{id:"问题"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[a._v("#")]),a._v(" 问题")]),a._v(" "),v("p",[a._v("接到一个紧急修复需求，发现一个 H5 游戏在 iOS9 下显示高度没有铺满屏幕，需要调整高度达到自适应。")]),a._v(" "),v("h2",{attrs:{id:"需求分析"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#需求分析"}},[a._v("#")]),a._v(" 需求分析")]),a._v(" "),v("ol",[v("li",[a._v("页面是一个 iframe，由 jssdk 控制")]),a._v(" "),v("li",[a._v("iframe 高度 100%，但在 iOS9 下，底部遮盖高度 20px")]),a._v(" "),v("li",[a._v("顶部黑边 20px，由底层写死，js 无法控制")]),a._v(" "),v("li",[a._v("顶部黑边不能移除，目的需要兼容曲面屏")])]),a._v(" "),v("h2",{attrs:{id:"初步结论"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#初步结论"}},[a._v("#")]),a._v(" 初步结论")]),a._v(" "),v("p",[a._v("在 iOS9 下，iframe 的高度 100% 并不是屏幕的高度")]),a._v(" "),v("h2",{attrs:{id:"验证结论"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#验证结论"}},[a._v("#")]),a._v(" 验证结论")]),a._v(" "),v("h3",{attrs:{id:"调试环境"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#调试环境"}},[a._v("#")]),a._v(" 调试环境")]),a._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://www.charlesproxy.com/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Charles"),v("OutboundLink")],1),a._v("：Web 调试代理应用程序")]),a._v(" "),v("li",[a._v("测试机和电脑在同一局域网")])]),a._v(" "),v("h3",{attrs:{id:"配置-charles"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#配置-charles"}},[a._v("#")]),a._v(" 配置 Charles")]),a._v(" "),v("ol",[v("li",[a._v("打开 Charles，确保已开启 "),v("code",[a._v("Record")]),a._v(" 、 "),v("code",[a._v("SSL Proxy")]),a._v(" 和 "),v("code",[a._v("Windows Proxy")])]),a._v(" "),v("li",[a._v("打开 "),v("code",[a._v("SSL Proxy")]),a._v(" 设置："),v("code",[a._v("Proxy")]),a._v(" - "),v("code",[a._v("SSL Proxying Settings")]),a._v("，添加本地代理："),v("code",[a._v("*:443")])]),a._v(" "),v("li",[a._v("记住代理端口："),v("code",[a._v("Proxy")]),a._v(" - "),v("code",[a._v("Proxy Settings")])])]),a._v(" "),v("h3",{attrs:{id:"配置测试机"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#配置测试机"}},[a._v("#")]),a._v(" 配置测试机")]),a._v(" "),v("ol",[v("li",[a._v("卸载游戏重新安装")]),a._v(" "),v("li",[a._v("设置 WIFI 手动代理，IP 为电脑局域网 IP，端口为代理端口")]),a._v(" "),v("li",[a._v("安装 SSL 证书，测试机访问并安装："),v("code",[a._v("chls.pro/ssl")])])]),a._v(" "),v("h3",{attrs:{id:"使用-charles"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#使用-charles"}},[a._v("#")]),a._v(" 使用 Charles")]),a._v(" "),v("ol",[v("li",[a._v("测试机打开游戏，在 Charles 抓到对应的 js")]),a._v(" "),v("li",[a._v("右键 js，选择 "),v("code",[a._v("Map Local")]),a._v("，"),v("code",[a._v("Map From")]),a._v(" 已自动填写，选择 "),v("code",[a._v("Map To")]),a._v(" 为本地的 js")]),a._v(" "),v("li",[a._v("清除 Charles 本地 Session，测试机重新打开游戏，现在，js 已经被替换成本地了")])]),a._v(" "),v("h2",{attrs:{id:"得到结论"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#得到结论"}},[a._v("#")]),a._v(" 得到结论")]),a._v(" "),v("p",[a._v("由于 "),v("code",[a._v("console")]),a._v(" 和 "),v("code",[a._v("alert")]),a._v(" 看不到信息，所以直接把信息写到 html 上")]),a._v(" "),v("p",[a._v("分析发现： "),v("code",[a._v("screen.height")]),a._v(" 和 iframe 的 "),v("code",[a._v("clientHeight")]),a._v(" 相等，也就是顶部黑边高度也算进去了，所以需要减去黑边")]),a._v(" "),v("h2",{attrs:{id:"总结"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),v("p",[a._v("最麻烦的调试莫过于，有限时间内，线上代码动不得，本地代码难测，于是就有了本文，通过“自己劫持自己”的方式，更优雅快速地调试并修复 BUG，同理，这种方式可以运用到微信开发等。")]),a._v(" "),v("h2",{attrs:{id:"附言"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#附言"}},[a._v("#")]),a._v(" 附言")]),a._v(" "),v("p",[a._v("Charles，是一个抓包神器，不仅可以用于调试，而且还可以模拟网络状态（后面来了个添加 Loading 效果的需求，刚好这个功能可以模拟慢速网络），当然还有很多其它用处。")])])}),[],!1,null,null,null);_.default=t.exports}}]);